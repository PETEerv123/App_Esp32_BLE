<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Web BLE ECG</title>
<link rel="icon" type="image/x-icon" href="favicon.ico" />
<style>
body { font-family: Arial; margin: 20px; }
button { margin: 5px; padding: 10px; }
#log { white-space: pre-line; padding: 10px; border: 1px solid #ccc; height: 200px; overflow-y: auto; }
</style>
</head>

<body>

<h2>ðŸ”µ Web Bluetooth Scanner</h2>

<button id="scanBtn">SCAN BLE</button>
<button id="disconnectBtn" disabled>Disconnect</button>

<h3>ðŸ“¡ Scan result:</h3>
<div id="deviceName">None</div>

<h3>ðŸ”§ Connection Info:</h3>
<div>Status: <span id="status">Disconnected</span></div>
<div>Device ID: <span id="deviceId">None</span></div>
<div>Service UUID: <span id="serviceUUID">None</span></div>
<div>Characteristic UUID: <span id="charUUID">None</span></div>

<h3>ðŸ“¥ Received Data:</h3>
<div id="dataArea">No data...</div>

<script>

// UUIDs
const SERVICE_UUID = "00000259-0000-1000-8000-00805f9b34fb";
const CHAR_UUID    = "00002A37-0000-1000-8000-00805f9b34fb";

let device, server, service, characteristic;

document.getElementById("scanBtn").onclick = async () => {
    try {
        device = await navigator.bluetooth.requestDevice({
            filters: [{ services: [SERVICE_UUID] }],
        });

        document.getElementById("deviceName").textContent = device.name;
        document.getElementById("status").textContent = "Connecting...";
        document.getElementById("deviceId").textContent = device.id;

        device.addEventListener("gattserverdisconnected", () => {
            document.getElementById("status").textContent = "Disconnected";
        });

        server = await device.gatt.connect();
        document.getElementById("status").textContent = "Connected";

        service = await server.getPrimaryService(SERVICE_UUID);
        characteristic = await service.getCharacteristic(CHAR_UUID);

        document.getElementById("serviceUUID").textContent = SERVICE_UUID;
        document.getElementById("charUUID").textContent = CHAR_UUID;

        await characteristic.startNotifications();
        characteristic.addEventListener("characteristicvaluechanged", e => {
            const v = e.target.value;
            let hr = v.getUint8(1);
            document.getElementById("dataArea").textContent = "HR: " + hr;
        });

        document.getElementById("disconnectBtn").disabled = false;

    } catch (e) {
        alert("Error: " + e);
    }
};

document.getElementById("disconnectBtn").onclick = () => {
    if (device && device.gatt.connected) device.gatt.disconnect();
    document.getElementById("status").textContent = "Disconnected";
};

</script>
</body>
</html>
